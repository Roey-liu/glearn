## PCIe

<div align="center"> <img src="pic/PCIe.png"/> </div>

一般网卡采用DMA控制器通过PCIe Bus访问内存， 除了对以太网数据内
容的读写外， 还有DMA描述符操作相关的读写， 这些操作也由
MRd/MWr来完成

## 网卡DMA描述符环形队列

DMA（Direct Memory Access， 直接存储器访问） 是一种高速的数
据传输方式， 允许在外部设备和存储器之间直接读写数据。 数据既不通
过CPU， 也不需要CPU干预。 整个数据传输操作在DMA控制器的控制
下进行。 


网卡DMA控制器通过环形队列与CPU交互。

环形队列由一组控制寄存器和一块物理上连续的缓存构成。 

主要的控制寄存器有Base、
Size、 Head和Tail。 通过设置Base寄存器， 可以将分配的一段物理连续
的内存地址作为环形队列的起始地址， 通告给DMA控制器。 同样通过
Size寄存器， 可以通告该内存块的大小。 Head寄存器往往对软件只读，
它表示硬件当前访问的描述符单元。 而Tail寄存器则由软件来填写更
新， 通知DMA控制器当前已准备好被硬件访问的描述符单元。


无论进行收包还是发包， 网卡驱动软件需要完成最基本的操作包
括， 1） 填充缓冲区地址到描述符； 2） 移动尾指针； 3） 判断描述符中
的完成状态位。 


DMA操作可以利用Intel®处理器的Direct Data
IO（DDIO） 技术， 从而减少对内存的访问。 

DMA控制器通过一组描述符环行队列与CPU互操作完成包的收
发。 环形队列的内容部分位于主存中， 控制部分通过访问外设寄存器的
方式完成