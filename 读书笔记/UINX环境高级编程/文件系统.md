# 二.文件和目录

## 文件系统

文件在块设备上是如何存储的

<div align="center"> <img src="pic/文件系统.png"/> </div>

```
（1）超级区
       负责“块设备”空间的分配和回收。

（2）inode节点区
       1）被划分为了一个个相连的，空间大小相同的inode节点空间。
       2）每个节点空间被用于存放某个文件的属性信息，每个节点空间大小是固定的
       3）每个节点都有一个节点编号，通过节点编号就可以索引找到inode节点空间。

（3）数据区
      存储数据时，实际上并不是数据有多少个字节，就分配对应多少的字节空间给你，为了便于物理空间高效管理，往往都是按块 分配空间的，一块往往为4k字节（4*1024）

       1）普通文件
       2）目录文件:  所包含文件的基本信息： 文件名 文件inode节点编号
       3）链接文件:  存放的数据很简单，就是所指向文件的文件名。

```

文件系统是如何通过“文件路径名”索引找到文件 ？
**fd = open("/new/xxx.txt", O_RDWR);** 
<div align="center"> <img src="pic/文件系统2.png"/> </div>
找到数据存放空间的起始地址后，read、write调用驱动读写数据时， 块设备驱动程序”通过这个地址，就能够实现读写


## 1.硬链接与软链接
* 每个inode中有一个链接数，其值为指向该inode的目录项数。只有当链接数减为0时，才删除该文件。链接数包含在`stat`结构的`st_nlink`成员中。**这种链接类型称为硬链接**
* 另外一种链接类型称为**符号链接**。符号链接文件的实际内容（在数据块中）包含了该符号链接所指向的文件的名字

> 说白了就是 创建硬链接，就是再为文件创建一个名字。指向的同一个inode节点，  只有inode节点代表了文件的真实存在。
> 软链接就是一个普通文件，只是数据块内容有点特殊。存放的内容是另一文件的路径名的指向


## 2.文件类型


```c
struct stat{
    mode_t              st_mode;    /*文件模式字，包含有文件类型、ID和读写权限位信息*/
    ino_t               st_ino;     /* inode号 */
    dev_t               st_dev;     /* 设备号（文件系统） */
    dev_t               st_rdev;    /* 特殊文件的设备号 */
    nlink_t             st_nlink;   /* 链接数 */
    uid_t               st_uid;     /* 所有者的用户ID */
    gid_t               st_gid;     /* 组所有者的ID */
    off_t               st_size;    /* 字节大小，用于一般文件 */
    struct timespec     st_atime;   /* 最后一次访问时间 */
    struct timespec     st_mtime;   /* 最后一次修改时间 */
    struct timespec     st_ctime;   /* 最后一个文件状态改变的时间 */
    blksize_t           st_blksize; /* 磁盘块(block)大小 */
    blkcnt_t            st_blocks;  /* 分配的磁盘块(block)数量 */
};
```


Linux一切皆文件，文件一共分为7类分别是 - d c s p l b。


* **普通(一般)文件**
* **目录文件**
* **块特殊文件**：这种类型的文件提供对设备（如磁盘）带缓冲的访问，每次访问以固定长度为单位进行
* **字符特殊文件**：这种类型的文件提供对设备不带缓冲的访问，每次访问长度可变（系统中的所有设备要么是字符特殊文件，要么是块特殊文件）
* **FIFO**：这种类型的文件用于进程间通信，有时也称为命名管道
* **套接字**：这种类型的文件用于进程间的网络通信
* **符号链接**：这种类型的文件指向另一个文件

文件类型信息包含在`stat`结构的`st_mode`成员中。


## 3.用户ID和组ID

<div align="center"> <img src="pic/apue-filestat-4.png"/> </div>